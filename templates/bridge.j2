# {{ ansible_managed }}

# network interface settings; autogenerated
# Please do NOT modify this file directly, unless you know what
# you're doing.
#
# If you want to manage parts of the network configuration manually,
# please utilize the 'source' or 'source-directory' directives to do
# so.
# PVE will preserve these directives, but will NOT read its network
# configuration from sourced files, so do not attempt to move any of
# the PVE managed interfaces into external files!

source /etc/network/interfaces.d/*

auto lo
iface lo inet loopback

iface lo inet6 loopback

iface {{ bridged_interface }} inet manual

auto vmbr0
iface vmbr0 inet static
        address {{ ansible_default_ipv4.address }}/{{ ansible_default_ipv4.prefix }}
        gateway {{ ansible_default_ipv4.gateway }}
        bridge_ports {{ bridged_interface }}
        bridge_stp off
        bridge_fd 0

{% for item in pve_vswitch_vlans | default([]) %}
iface {{ item.bridged_interface | default(bridged_interface) }}.{{ item.vswitch_vlanid }} inet manual
auto vmbr{{ item.vswitch_vlanid }}
iface vmbr{{ item.vswitch_vlanid }} inet manual
        bridge_ports {{ item.bridged_interface | default(bridged_interface) }}.{{ item.vswitch_vlanid }}
        bridge_stp {{ item.bridge_stp }}
        bridge_fd {{ item.bridge_fd }}
        mtu {{ item.mtu }}
{% endfor %}
